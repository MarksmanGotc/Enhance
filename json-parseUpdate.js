function loadBuildings(e){e.innerHTML="";for(let t in build){let n=document.createElement("option");n.value=t,n.textContent=t,e.appendChild(n)}loadEnhancements(e.parentNode.parentNode.querySelector(".enhancementSelect"))}function loadEnhancements(e){let t=e.parentNode.parentNode.querySelector(".buildingSelect").value;e.innerHTML="";let n=build[t];for(let t in n){let l=document.createElement("option");l.value=n[t],l.textContent=t,e.appendChild(l)}}function addAnotherBuilding(){document.querySelectorAll(".buildingBlock.start").forEach((function(e){e.classList.remove("start")})),document.querySelectorAll(".buildingBlock.animated").forEach((function(e){e.classList.remove("animated")}));var e=document.createElement("div");e.className="buildingBlock animated";var t=document.getElementById("buildingBlocksContainer"),n=document.createElement("div");n.innerHTML='<p><svg xmlns="http://www.w3.org/2000/svg" height="16" width="12" viewBox="0 0 384 512">\x3c!--!Font Awesome Pro 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc.--\x3e<path d="M326.6 166.6L349.3 144 304 98.7l-22.6 22.6L192 210.7l-89.4-89.4L80 98.7 34.7 144l22.6 22.6L146.7 256 57.4 345.4 34.7 368 80 413.3l22.6-22.6L192 301.3l89.4 89.4L304 413.3 349.3 368l-22.6-22.6L237.3 256l89.4-89.4z"/></svg></p>',n.className="removeButton",document.getElementById("buildingBlocksContainer").addEventListener("click",(function(e){if(e.target.closest(".removeButton")){var t=e.target.closest(".buildingBlock");t&&(t.remove(),gtag("event","remove_building_click",{event_label:"remove Building"}))}})),e.appendChild(n),e.innerHTML+='\n        <div class="selectBuilds">\n            <div class="selectBuild">\n                <label for="buildingSelect">Select Building:</label>\n                <select class="buildingSelect"></select>\n            </div>\n            <div class="selectEnhance">\n                <label for="enhancementSelect">Select Enhancement:</label>\n                <select class="enhancementSelect"></select>\n            </div>\n        </div>\n        <div class="selectLevel">\n            <div class="currentLevel">\n                <label for="currentLevel">Current level:</label>\n                <input type="number" class="currentLevel" min="0" max="34" value="0">\n            </div>\n            <div class="targetLevel">\n                <label for="targetLevel">Update level:</label>\n                <input type="number" class="targetLevel" min="2" max="40" value="40">\n            </div>\n        </div>',t.appendChild(e);var l=e.querySelector(".buildingSelect"),a=e.querySelector(".enhancementSelect");loadBuildings(l),l.addEventListener("change",(function(){loadEnhancements(a)})),adjustLevelInputs(e),gtag("event","add_building_click",{event_label:"Add Building"});var o=e.offsetTop-20;window.scrollTo({top:o,behavior:"smooth"}),setTimeout((()=>e.classList.remove("animated")),4e3)}function calculateCost(){var e={slate:0,marble:0,limestone:0,brick:0,pine:0,keystone:0,valyrianStone:0},t={slate:0,marble:0,limestone:0,keystone:0,valyrianStone:0},n=[],l=document.getElementById("costSummary"),a=new Intl.NumberFormat("en-US"),o=(l=document.getElementById("costSummary"),document.querySelector(".wrapper"));l.innerHTML="";var i=document.querySelectorAll(".buildingBlock");for(let o=0;o<i.length;o++){let y=i[o],f=y.querySelector(".enhancementSelect"),h=y.querySelector(".currentLevel input"),g=y.querySelector(".targetLevel input"),S=parseInt(h.value,10),L=parseInt(g.value,10);var r={slate:0,marble:0,limestone:0,brick:0,pine:0,keystone:0,valyrianStone:0},c={},s=[];let b=y.querySelector(".buildingSelect").value;if("Enhancement 4"===f.options[f.selectedIndex].text){let e=enhancement4Prices.Special,t=build[b]["Enhancement 4"];for(let n=S;n<L;n++){r.slate+=e[n].Slate,r.marble+=e[n].Marble,r.limestone+=e[n].Limestone,r.brick+=e[n].Brick,r.pine+=e[n].Pine,r.keystone+=e[n].Keystone,r.valyrianStone+=e[n]["Valyrian Stone"]||0,t[n].Enhancements.forEach((e=>{let l=e.Type,a="string"==typeof e.Value?parseFloat(e.Value.replace("%","")):parseFloat(e.Value);if(c[l]||(c[l]=0),t[n+1]){let e=t[n+1].Enhancements.find((e=>e.Type===l));if(e){let t="string"==typeof e.Value?parseFloat(e.Value.replace("%","")):parseFloat(e.Value);c[l]+=t-a}}}))}for(let e in c){let t=c[e];0!==t&&("Barracks Training Capacity"===e||"March Size vs. Seats of Power"===e||"Rallied Troops vs. Seats of Power"===e||"Free Build Time"===e||"Rallied Troop Capacity"===e||"Range Training Capacity"===e||"Wounded Capacity"===e||"Dragon: Max March Size"===e||"Stable Training Capacity"===e||"Training Capacity"===e||"Reinforcement Capacity for Seats of Power"===e||"Rally Slots"===e||"Single March Size vs. Player"===e||"March Slots"===e||"Workshop Training Capacity"===e?s.push(`${e}: ${t.toLocaleString("en-US")}`):s.push(`${e}: ${t.toFixed(2)}%`))}s.forEach((e=>n.push(e)))}else{let e=price[f.value];for(let t=S;t<L;t++)r.slate+=e[t].Slate,r.marble+=e[t].Marble,r.limestone+=e[t].Limestone,r.brick+=e[t].Brick,r.pine+=e[t].Pine,r.keystone+=e[t].Keystone,r.valyrianStone+=e[t]["Valyrian Stone"]||0;var d=e[L-1].Value-(S>0?e[S-1].Value:0);if(0!==d){let e=`${f.options[f.selectedIndex].text}: ${d.toFixed(2)}%`;s.push(e),n.push(e)}}var u={slate:0,marble:0,limestone:0,keystone:0,valyrianStone:0};let E=!1;for(let n in r){let l=r[n],a=0;"marble"===n?a=parseFloat(document.querySelector(".aleMarble").value)||0:"keystone"===n?a=parseFloat(document.querySelector(".aleKeystone").value)||0:"slate"===n&&(a=parseFloat(document.querySelector(".aleSlate").value)||0);let o=Math.round(100/(a+100)*l);u[n]=l-o,r[n]=o,e[n]+=o,t[n]+=u[n],a>0&&(E=!0)}if(E){let e=document.querySelector(".buttons");if(e&&!document.querySelector(".warning")){let t=document.createElement("p");t.className="warning",t.textContent="The discounted value is not completely accurate, WB does not provide the correct discount value.",e.insertAdjacentElement("afterend",t)}}var p=f.options[f.selectedIndex].text,m=y.querySelector(".buildingSelect").options[y.querySelector(".buildingSelect").selectedIndex].text,v=document.createElement("div");v.classList.add("costBox"),v.innerHTML=`\n            <h4>${m} - ${p}</h4>\n            <p class="level">Level ${S} to ${L}</p>\n        `,s.length>1?v.innerHTML+=`<p class="stats">Stats increase:</p><div class="stats">${s.map((e=>`<p>${e}</p>`)).join("")}</div>`:1===s.length&&(v.innerHTML+=`<p class="stats">Stats increase: ${s[0]}</p>`);for(let e in r)v.innerHTML+=`\n                <p>${e.charAt(0).toUpperCase()+e.slice(1)}: ${a.format(r[e])}</p>\n                ${u[e]>0?`<span>Cost Efficiency saved on ${e.charAt(0).toUpperCase()+e.slice(1)}: ${a.format(u[e])}</span>`:""}\n            `;l.appendChild(v)}if(i.length>1){var y=document.createElement("div");y.classList.add("totalCosts");var f=n.map((e=>`<p class="stats">${e}</p>`)).join("");y.innerHTML=`\n            <h3>Costs in total:</h3>\n            ${f}\n        `;for(let n in e)y.innerHTML+=`\n                <p>${n.charAt(0).toUpperCase()+n.slice(1)}: ${a.format(e[n])}</p>\n                ${t[n]>0?`<span>Cost Efficiency saved on ${n.charAt(0).toUpperCase()+n.slice(1)}: ${a.format(t[n])}</span>`:""}\n            `;l.appendChild(y)}if(!document.getElementById("closeResults")){let e=document.createElement("button");e.id="closeResults",e.innerHTML='\n\t\t\t<span>Click here to go back and modify your selections</span>\n\t\t\t<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">\n\t\t\t\t<path d="M345 137c9.4-9.4 9.4-24.6 0-33.9s-24.6-9.4-33.9 0l-119 119L73 103c-9.4-9.4-24.6-9.4-33.9 0s-9.4 24.6 0 33.9l119 119L39 375c-9.4 9.4-9.4 24.6 0 33.9s24.6 9.4 33.9 0l119-119L311 409c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-119-119L345 137z"></path>\n\t\t\t</svg>';let t=document.createElement("div");t.appendChild(e),t.classList.add("closeWrapper"),t.addEventListener("click",(function(){o.style.display="block",l.style.display="none",window.scrollTo({top:0,behavior:"smooth"})})),l.prepend(t)}o.style.display="none",l.style.display="flex",window.scrollTo({top:0,behavior:"smooth"})}function adjustLevelInputs(e){var t=e.querySelector(".currentLevel input"),n=e.querySelector(".targetLevel input");t.addEventListener("change",(function(){var e=parseInt(t.value,10);n.min=e+1,parseInt(n.value,10)<=e&&(n.value=e+1)})),n.addEventListener("change",(function(){var e=parseInt(t.value,10);parseInt(n.value,10)<=e&&(n.value=e+1)}))}function smoothScrollTo(e){const t=document.getElementById(e);if(!t)return;const n=t.offsetTop,l=window.pageYOffset,a=n-l;let o=null;window.requestAnimationFrame((function e(t){o||(o=t);const n=t-o,i=(r=n/500,r<.5?4*r*r*r:1-Math.pow(-2*r+2,3)/2);var r;window.scrollTo(0,l+a*i),n<500&&window.requestAnimationFrame(e)}))}document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll("footer svg, #openGiftFromHeader").forEach((e=>{e.addEventListener("click",(function(){const e=document.querySelectorAll(".page > div"),t=document.querySelector(".page .gift");e.forEach((e=>{e.style.display="none"})),t.style.display="flex"}))})),document.querySelector(".gift button").addEventListener("click",(function(){const e=document.querySelectorAll(".page > div"),t=document.querySelector(".page .wrapper");e.forEach((e=>{e.style.display="none"})),t.style.display="block"}))})),document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll(".buildingSelect").forEach((function(e){loadBuildings(e)})),document.querySelectorAll(".buildingSelect").forEach((function(e){e.addEventListener("change",(function(){loadEnhancements(this.parentNode.parentNode.querySelector(".enhancementSelect"))}))})),document.querySelectorAll(".buildingBlock").forEach(adjustLevelInputs)}));
