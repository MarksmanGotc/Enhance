function loadBuildings(e){e.innerHTML="";for(let t in build){let n=document.createElement("option");n.value=t,n.textContent=t,e.appendChild(n)}loadEnhancements(e.parentNode.parentNode.querySelector(".enhancementSelect"))}function loadEnhancements(e){let t=e.parentNode.parentNode.querySelector(".buildingSelect").value;e.innerHTML="";let n=build[t];for(let t in n){let l=document.createElement("option");l.value=n[t],l.textContent=t,e.appendChild(l)}}function addAnotherBuilding(){document.querySelectorAll(".buildingBlock.start").forEach((function(e){e.classList.remove("start")})),document.querySelectorAll(".buildingBlock.animated").forEach((function(e){e.classList.remove("animated")}));var e=document.createElement("div");e.className="buildingBlock animated";var t=document.getElementById("buildingBlocksContainer"),n=document.createElement("div");n.innerHTML='<p><svg xmlns="http://www.w3.org/2000/svg" height="16" width="12" viewBox="0 0 384 512">\x3c!--!Font Awesome Pro 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc.--\x3e<path d="M326.6 166.6L349.3 144 304 98.7l-22.6 22.6L192 210.7l-89.4-89.4L80 98.7 34.7 144l22.6 22.6L146.7 256 57.4 345.4 34.7 368 80 413.3l22.6-22.6L192 301.3l89.4 89.4L304 413.3 349.3 368l-22.6-22.6L237.3 256l89.4-89.4z"/></svg></p>',n.className="removeButton",document.getElementById("buildingBlocksContainer").addEventListener("click",(function(e){if(e.target.closest(".removeButton")){var t=e.target.closest(".buildingBlock");t&&(t.remove(),gtag("event","remove_building_click",{event_label:"remove Building"}))}})),e.appendChild(n),e.innerHTML+='\n        <div class="selectBuilds">\n            <div class="selectBuild">\n                <label for="buildingSelect">Select Building:</label>\n                <select class="buildingSelect"></select>\n            </div>\n            <div class="selectEnhance">\n                <label for="enhancementSelect">Select Enhancement:</label>\n                <select class="enhancementSelect"></select>\n            </div>\n        </div>\n        <div class="selectLevel">\n            <div class="currentLevel">\n                <label for="currentLevel">Current level:</label>\n                <input type="number" class="currentLevel" min="0" max="34" value="0">\n            </div>\n            <div class="targetLevel">\n                <label for="targetLevel">Update level:</label>\n                <input type="number" class="targetLevel" min="2" max="40" value="40">\n            </div>\n        </div>',t.appendChild(e);var l=e.querySelector(".buildingSelect"),a=e.querySelector(".enhancementSelect");loadBuildings(l),l.addEventListener("change",(function(){loadEnhancements(a)})),adjustLevelInputs(e),gtag("event","add_building_click",{event_label:"Add Building"});var o=e.offsetTop-20;window.scrollTo({top:o,behavior:"smooth"}),setTimeout((()=>e.classList.remove("animated")),4e3)}function calculateCost(){var e={slate:0,marble:0,limestone:0,brick:0,pine:0,keystone:0,valyrianStone:0},t={slate:0,marble:0,limestone:0,keystone:0,valyrianStone:0},n=[],l=document.getElementById("costSummary"),a=new Intl.NumberFormat("en-US"),o=document.querySelector(".wrapper"),i="true"===new URLSearchParams(window.location.search).get("debug");l.innerHTML="";var r=document.querySelectorAll(".buildingBlock");for(let o=0;o<r.length;o++){let h=r[o],y=h.querySelector(".enhancementSelect"),g=h.querySelector(".currentLevel input"),S=h.querySelector(".targetLevel input"),L=parseInt(g.value,10),b=parseInt(S.value,10);var c={slate:0,marble:0,limestone:0,brick:0,pine:0,keystone:0,valyrianStone:0},s={},d=[];let E=h.querySelector(".buildingSelect").value;if("Enhancement 4"===y.options[y.selectedIndex].text){let e=enhancement4Prices.Special,t=build[E]["Enhancement 4"];for(let n=L;n<b;n++){c.slate+=e[n].Slate,c.marble+=e[n].Marble,c.limestone+=e[n].Limestone,c.brick+=e[n].Brick,c.pine+=e[n].Pine,c.keystone+=e[n].Keystone,c.valyrianStone+=e[n]["Valyrian Stone"]||0,t[n].Enhancements.forEach((e=>{let l=e.Type,a="string"==typeof e.Value?parseFloat(e.Value.replace("%","")):parseFloat(e.Value);if(s[l]||(s[l]=0),t[n+1]){let e=t[n+1].Enhancements.find((e=>e.Type===l));if(e){let t="string"==typeof e.Value?parseFloat(e.Value.replace("%","")):parseFloat(e.Value);s[l]+=t-a}}}))}for(let e in s){let t=s[e];if(0!==t)if("Free Build Time"===e){let n=formatTime(t);d.push(`${e}: ${n}`)}else"Barracks Training Capacity"===e||"March Size vs. Seats of Power"===e||"Rallied Troops vs. Seats of Power"===e||"Rallied Troop Capacity"===e||"Range Training Capacity"===e||"Wounded Capacity"===e||"Dragon: Max March Size"===e||"Stable Training Capacity"===e||"Training Capacity"===e||"Reinforcement Capacity for Seats of Power"===e||"Rally Slots"===e||"Single March Size vs. Player"===e||"March Slots"===e||"Workshop Training Capacity"===e?d.push(`${e}: ${t.toLocaleString("en-US")}`):d.push(`${e}: ${t.toFixed(2)}%`)}d.forEach((e=>n.push(e)))}else{let e=price[y.value];for(let t=L;t<b;t++)c.slate+=e[t].Slate,c.marble+=e[t].Marble,c.limestone+=e[t].Limestone,c.brick+=e[t].Brick,c.pine+=e[t].Pine,c.keystone+=e[t].Keystone,c.valyrianStone+=e[t]["Valyrian Stone"]||0;var u=e[b-1].Value-(L>0?e[L-1].Value:0);if(0!==u){let e=`${y.options[y.selectedIndex].text}: ${u.toFixed(2)}%`;d.push(e),n.push(e)}}var p={slate:0,marble:0,limestone:0,keystone:0,valyrianStone:0};for(let n in c){let l=c[n],a=0;"marble"===n?a=parseFloat(document.querySelector(".aleMarble").value)||0:"keystone"===n?a=parseFloat(document.querySelector(".aleKeystone").value)||0:"slate"===n&&(a=parseFloat(document.querySelector(".aleSlate").value)||0);let o=Math.round(100/(a+100)*l);p[n]=l-o,c[n]=o,e[n]+=o,t[n]+=p[n]}var m=y.options[y.selectedIndex].text,v=h.querySelector(".buildingSelect").options[h.querySelector(".buildingSelect").selectedIndex].text,f=document.createElement("div");f.classList.add("costBox"),f.innerHTML=`\n            <h4>${v} - ${m}</h4>\n            <p class="level">Level ${L} to ${b}</p>\n        `,i||gtag("event","enhance_calc",{enhance_upgrade:`${v} - ${m}; Level ${L} to ${b}`,enhance_value:`${v} - ${m}; Level ${L} to ${b}`,value:1}),d.length>1?f.innerHTML+=`<p class="stats">Stats increase:</p><div class="stats">${d.map((e=>`<p>${e}</p>`)).join("")}</div>`:1===d.length&&(f.innerHTML+=`<p class="stats">Stats increase: ${d[0]}</p>`);for(let e in c)f.innerHTML+=`\n                <p>${e.charAt(0).toUpperCase()+e.slice(1)}: ${a.format(c[e])}</p>\n                ${p[e]>0?`<span>Cost Efficiency saved on ${e.charAt(0).toUpperCase()+e.slice(1)}: ${a.format(p[e])}</span>`:""}\n            `;l.appendChild(f)}if(r.length>1){var h=document.createElement("div");h.classList.add("totalCosts");var y=n.map((e=>`<p class="stats">${e}</p>`)).join("");h.innerHTML=`\n            <h3>Costs in total:</h3>\n            ${y}\n        `;for(let n in e)h.innerHTML+=`\n                <p>${n.charAt(0).toUpperCase()+n.slice(1)}: ${a.format(e[n])}</p>\n                ${t[n]>0?`<span>Cost Efficiency saved on ${n.charAt(0).toUpperCase()+n.slice(1)}: ${a.format(t[n])}</span>`:""}\n            `;l.appendChild(h)}if(!document.getElementById("closeResults")){let e=document.createElement("button");e.id="closeResults",e.innerHTML='\n\t\t\t<span>Click here to go back and modify your selections</span>\n\t\t\t<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">\n\t\t\t\t<path d="M345 137c9.4-9.4 9.4-24.6 0-33.9s-24.6-9.4-33.9 0l-119 119L73 103c-9.4-9.4-24.6-9.4-33.9 0s-9.4 24.6 0 33.9l119 119L39 375c-9.4 9.4-9.4 24.6 0 33.9s24.6 9.4 33.9 0l119-119L311 409c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-119-119L345 137z"></path>\n\t\t\t</svg>';let t=document.createElement("div");t.appendChild(e),t.classList.add("closeWrapper"),t.addEventListener("click",(function(){o.style.display="block",l.style.display="none",window.scrollTo({top:0,behavior:"smooth"})})),l.prepend(t)}o.style.display="none",l.style.display="flex",window.scrollTo({top:0,behavior:"smooth"})}function formatTime(e){const t=Math.floor(e/3600),n=Math.floor(e%3600/60),l=e%60;let a="";return t>0&&(a+=`${t}h `),n>0&&(a+=`${n}m `),(l>0||""===a)&&(a+=`${l}s`),a.trim()}function adjustLevelInputs(e){var t=e.querySelector(".currentLevel input"),n=e.querySelector(".targetLevel input");t.addEventListener("change",(function(){var e=parseInt(t.value,10);n.min=e+1,parseInt(n.value,10)<=e&&(n.value=e+1)})),n.addEventListener("change",(function(){var e=parseInt(t.value,10);parseInt(n.value,10)<=e&&(n.value=e+1)}))}function smoothScrollTo(e){const t=document.getElementById(e);if(!t)return;const n=t.offsetTop,l=window.pageYOffset,a=n-l;let o=null;window.requestAnimationFrame((function e(t){o||(o=t);const n=t-o,i=(r=n/500,r<.5?4*r*r*r:1-Math.pow(-2*r+2,3)/2);var r;window.scrollTo(0,l+a*i),n<500&&window.requestAnimationFrame(e)}))}document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll("footer svg, #openGiftFromHeader").forEach((e=>{e.addEventListener("click",(function(){const e=document.querySelectorAll(".page > div"),t=document.querySelector(".page .gift");e.forEach((e=>{e.style.display="none"})),t.style.display="flex",gtag("event","donate_click",{event_label_gift:"Open domnate views"})}))})),document.querySelector(".gift button").addEventListener("click",(function(){const e=document.querySelectorAll(".page > div"),t=document.querySelector(".page .wrapper");e.forEach((e=>{e.style.display="none"})),t.style.display="block"}))})),document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll(".buildingSelect").forEach((function(e){loadBuildings(e)})),document.querySelectorAll(".buildingSelect").forEach((function(e){e.addEventListener("change",(function(){loadEnhancements(this.parentNode.parentNode.querySelector(".enhancementSelect"))}))})),document.querySelectorAll(".buildingBlock").forEach(adjustLevelInputs)}));
